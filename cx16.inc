!ifdef CX16_INC !eof
CX16_INC=1

KERNALVER	= $FF80
VIA1		= $9F60
VIA1PA		= VIA1+1
VIA1PB		= VIA1+0
VIA2		= $9F70
VIA2PA		= VIA2+1
VIA2PB		= VIA2+0

RAM_BANK	= $A000
ROM_BANK	= $C000

; Emulator
GIFCTRL		= $9FB5

; IRQ
IRQVECTOR	= $0314

; Text mode ports (not supported and changes between ROM releases)
COLORPORT	= $0376
NUMCOLS		= $0386
NUMLINES	= $0387

; ROM Bank allocations
KERNAL_BANK	= 0
KEYBD_BANK	= 1
CBDOS_BANK	= 2
GEOS_BANK	= 3
BASIC_BANK	= 4
MONITOR_BANK	= 5

; ZeroPage variables/pointers
TMP0		= $22
TMP1		= $23
TMP2		= $24
TMP3		= $25
TMP4		= $26
TMP5		= $27
TMP6		= $28
TMP7		= $29
TMP8		= $2A
TMP9		= $2B

; PETSCII color codes
PET_BLACK	= $90
PET_WHITE	= $05
PET_RED		= $1C
PET_CYAN	= $9F
PET_PURPLE	= $9C
PET_GREEN	= $1E
PET_BLUE	= $1F
PET_YELLOW	= $9E
PET_ORANGE	= $81
PET_BROWN	= $95
PET_LIGHTRED	= $96
PET_DARKGRAY	= $97
PET_MIDGRAY	= $98
PET_LIGHTGREEN	= $99
PET_LIGHTBLUE	= $9A
PET_LIGHTGRAY	= $9B

; Color values
BLACK		= 0
WHITE		= 1
RED		= 2
CYAN		= 3
PURPLE		= 4
GREEN		= 5
BLUE		= 6
YELLOW		= 7
ORANGE		= 8
BROWN		= 9
LIGHTRED	= 10
DARKGRAY	= 11
MIDGRAY		= 12
LIGHTGREEEN	= 13
LIGHTBLUE	= 14
LIGHTGRAY	= 15

; Joystick button values
NES_A		= $80
NES_B		= $40
NES_SEL		= $20
NES_STA		= $10
NES_UP		= $08
NES_DN		= $04
NES_LT		= $20
NES_RT		= $10
SNES_B		= $80
SNES_Y		= $40
SNES_SEL	= $20
SNES_STA	= $10
SNES_UP		= $08
SNES_DN		= $04
SNES_LT		= $02
SNES_RT		= $01
SNES_A		= $80
SNES_X		= $40
SNES_L		= $20
SNES_R		= $10

; "ABI" registers in ZeroPage
r0		= $02
r0l		= r0
r0h		= r0+1
r1		= $04
r1l		= r1
r1h		= r1+1
r2		= $06
r2l		= r2
r2h		= r2+1
r3		= $08
r3l		= r3
r3h		= r3+1
r4		= $0A
r4l		= r4
r4h		= r4+1
r5		= $0C
r5l		= r5
r5h		= r5+1
r6		= $0E
r6l		= r6
r6h		= r6+1
r7		= $10
r7l		= r7
r7h		= r7+1
r8		= $12
r8l		= r8
r8h		= r8+1
r9		= $14
r9l		= r9
r9h		= r9+1
r10		= $16
r10l		= r10
r10h		= r10+1
r11		= $18
r11l		= r11
r11h		= r11+1
r12		= $1A
r12l		= r12
r12h		= r12+1
r13		= $1C
r13l		= r13
r13h		= r13+1
r14		= $1E
r14l		= r14
r14h		= r14+1
r15		= $20
r15l		= r15
r15h		= r15+1

; Commander X16 API
;clock
Clock_set_data_time	= $FF4D
Clock_get_date_time	= $FF50
;mouse
Mouse_config		= $FF68
Mouse_scan		= $FF71
Mouse_get		= $FF6B
;joystick
Joystick_scan		= $FF53
Joystick_get		= $FF56
;sprites
Sprite_set_image	= $FEF0
Sprite_set_position	= $FEF3
;framebuffer
FB_init			= $FEF6
FB_get_info		= $FEF9
FB_set_palette		= $FEFC
FB_cursor_position	= $FEFF
FB_cursor_next_line	= $FF02
FB_get_pixel		= $FF05
FB_get_pixels		= $FF08
FB_set_pixel		= $FF0B
FB_set_pixels		= $FF0E
FB_set_8_pixels		= $FF11
FB_set_8_pixels_opaque	= $FF14
FB_fill_pixels		= $FF17
FB_filter_pixels	= $FF1A
FB_move_pixels		= $FF1D
;graphics
Graph_init		= $FF20
Graph_clear		= $FF23
Graph_set_window	= $FF26
Graph_set_colors	= $FF29
Graph_draw_line		= $FF2C
Graph_draw_rect		= $FF2F
Graph_move_rect		= $FF32
Graph_draw_oval		= $FF35
Graph_draw_image	= $FF38
Graph_set_font		= $FF3B
Graph_get_char_size	= $FF3E
Graph_put_char		= $FF41
;console
Console_init		= $FEDB
Console_put_char	= $FEDE
Console_put_image	= $FED8
Console_get_char	= $FEE1
Console_set_paging_message	= $FED5
;other
Memory_fill		= $FEE4
Memory_copy		= $FEE7
Memory_crc		= $FEEA
Memory_decompress	= $FEED
Entropy_get		= $FECF
Monitor			= $FF44
Enter_basic		= $FF47
Screen_set_mode		= $FF5F
Screen_set_charset	= $FF62
JSRFAR			= $FF6E

; *****************************************************************************
; Save the address of the original interrupt handler
; *****************************************************************************
; USES:		A
; OUTPUTS:	Address of old handler will be passed back in .old_handler
; *****************************************************************************
!macro SAVE_INT_VECTOR .old_handler {
	lda	IRQVECTOR
	sta	.old_handler
	lda	IRQVECTOR+1
	sta	.old_handler+1
}

; *****************************************************************************
; Install new interrupt handler
; *****************************************************************************
; INPUTS:	.handler = address of new interrupt handler
; USES:		A
; *****************************************************************************
!macro INSTALL_INT_HANDLER .handler {
	sei			; Disable interrupts
	lda	#1		; Tell VERA that we want interrupts
	sta	VERA_IEN	; on each VSYNC
	lda	#<.handler	; Write address of local interrupt
	sta	IRQVECTOR	; handler to the interrupt
	lda	#>.handler	; vector address ($0314)
	sta	IRQVECTOR+1
	cli			; Enable interrupts
}

;******************************************************************************
; Code to enable program to be startet with the RUN command
;******************************************************************************
!macro SYS_LINE {
*=$801
	!word	$080C			; Pointer to next BASIC line
	!word	$000A			; Line number $000A = 10
	!byte	$9E			; SYS BASIC token
	!pet	" $810",0		; Address where ASM starts
	!word	$0000			; EOF BASIC program
*=$810
}

;******************************************************************************
; Get KERNAL version and convert it from 2's compliment number if it is a
; pre-release
;******************************************************************************
; RETURNS:	.A contains the KERNAL version
;		.C cleared if pre-release version
;******************************************************************************
!macro GET_KERNAL_VER {
	lda	VIA1PB			; Save current ROM bank
	tay				; in .Y
	and	#KERNAL_BANK|#$F8	; Set ROM bank to 0, only 3 lowest bits
	sta	VIA1PB			; are used to set ROM bank
	lda	KERNALVER		; Read KERNAL version
	sty	VIA1PB			; Restore ROM bank
	sec				; Set carry to show it is release-version
	bpl	.done			; If positive, we are done
	eor	#$FF			; Invert and add 1 to convert the 2's
	clc				; compliment number to the KERNAL version
	adc	#1
	clc				; Clear carry to show it is pre-release
.done:
}
